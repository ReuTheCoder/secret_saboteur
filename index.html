<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Pass n' Play</title>

  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#00BCD4;
  --primary-dark:#0097A7;
  --bg:#ffffff;
  --text:#212121;
  --muted:#6b6b6b;
  --card:#f7f7f7;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,system-ui;
  background:var(--bg);
  color:var(--text);
}

.screen{
  max-width:420px;
  margin:0 auto;
  padding:24px 16px 40px;
  display:none;
}

.screen.active { display: block !important; }

.flip-wrap {
  perspective: 1000px;
  margin-bottom: 20px;
}

@keyframes slideFadeIn {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.screen.results-animate {
  animation: slideFadeIn 0.8s ease forwards;
}

  #resultMessage {
  text-align: center;
  font-size: 1.8rem;
  margin-bottom: 12px;
  animation: popIn 0.4s ease;
}

  #multiSaboteurHint{
  animation: pulse 1.6s ease-in-out infinite;
}

@keyframes pulse{
  0%,100%{opacity:.6}
  50%{opacity:1}
}

@keyframes popIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

.correct {
  color: #2e7d32;
}

.incorrect {
  color: #c62828;
}

  #results button + button {
  margin-top: 12px;
}

  #currentName {
  margin-bottom: 16px;
}

.card.sab-card {
  background: #000;
  color: #fff;
  position: relative;
}

.info-btn {
  position: static;
  top: 12px;
  right: 12px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
 background: rgba(0,188,212,0.15);
  color: var(--primary);
  font-weight: 700;
  font-size: 1rem;
  padding: 0;
}

.info-btn:active {
  transform: scale(0.95);
}

 .hint-toggle {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  font-size: 0.9rem;
  color: var(--muted);
  margin-top: 12px;
  line-height: 1.3;
}

.hint-toggle input {
  margin-top: 3px;
  flex-shrink: 0;
}

.hint-toggle {
  flex-wrap: wrap;
}

  @media (max-width: 480px) {
  .hint-toggle {
    flex-direction: row;
  }
}
  .popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.popup.hidden {
  display: none;
}

.popup-content {
  background: white;
  color: var(--text);
  border-radius: 18px;
  padding: 20px;
  max-width: 320px;
  text-align: center;
}

  .confetti {
  position: fixed;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 999;
}

.confetti span {
  position: absolute;
  width: 8px;
  height: 12px;
  background: var(--primary);
  opacity: 0.9;
  animation: fall 1.8s linear forwards;
}
  #likelihoodHint {
  display: none;
}


@keyframes fall {
  from {
    transform: translateY(-20px) rotate(0deg);
  }
  to {
    transform: translateY(100vh) rotate(360deg);
  }
}

  #intro .info-btn {
  position: static;
  top: 16px;
  right: 16px;
    width: 44px;
  height: 44px;
  font-size: 1.1rem;
}
  #intro {
  position: relative;
}

  .small-btn {
  padding: 8px 12px;
  font-size: 0.9rem;
  width: auto;
  margin: 12px auto 20px;
  display: block;
}

#promptText {
  text-align: center;
  margin-top: 12px;
}

  .scale {
  gap: 6px;
}

  @keyframes pressPulse {
  0%   { transform: scale(1); }
  50%  { transform: scale(0.94); }
  100% { transform: scale(1); }
}

  @keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  50% { transform: translateX(4px); }
  75% { transform: translateX(-4px); }
  100% { transform: translateX(0); }
}

.shake {
  animation: shake 0.3s ease;
}
.scale div.pulse {
  animation: pressPulse 0.4s ease;
}

  .scale {
  opacity: 0;
  transform: translateY(12px);
  animation: scaleIn 0.5s ease forwards;
}

@keyframes scaleIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

  #guess {
  animation: glowPulse 2s ease-in-out infinite;
}

@keyframes glowPulse {
  0% {
    box-shadow: 0 0 0 rgba(0,188,212,0);
  }
  50% {
    box-shadow: 0 0 24px rgba(0,188,212,0.25);
  }
  100% {
    box-shadow: 0 0 0 rgba(0,188,212,0);
  }
}

  .info-btn {
  z-index: 100;
}
  .intro-info {
  margin-top: 28px;
  display: flex;
  justify-content: center;
}

  .hidden {
  display: none;
}

  #playerGrid button {
  width: auto;
  min-width: 64px;
}
  
  #playerGrid {
  grid-template-columns: repeat(4, 1fr);
  max-width: 300px;
  margin: 20px auto;
}
  
  button.selected{
  background:var(--primary);
  color:white;
  box-shadow:0 0 0 3px rgba(0,188,212,.35);
}

  .grid{
  justify-items:center;
}
.grid button{
  max-width:90px;
}
  #guess .grid{
  max-width:300px;
  margin:0 auto;
}

  #saboteurChoices button{
  width:auto;
  padding:10px 14px;
  font-size:0.95rem;
  min-width:90px;
}

  .likelihood-hint {
  text-align: center;
  font-size: 0.85rem;
  color: var(--muted);
  margin-top: 10px;
  opacity: 0.8;
}
  #home .grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

#home .grid button {
  width: 100%;
  max-width: 100%;
}
  
@media (min-width: 600px) {
  #home .grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

  /* Screen transitions */
.screen {
  opacity: 0;
  transform: translateY(16px);
  pointer-events: none;
  transition:
    opacity 0.35s ease,
    transform 0.35s ease;
}

.screen.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
  display: block;
}

/*  reverse motion for exit */
.screen.exit {
  opacity: 0;
  transform: translateY(-16px);
}

  .screen.from-right {
  transform: translateX(24px);
}

.screen.from-left {
  transform: translateX(-24px);
}
  #discussionStarter {
  font-size: 1.1rem;
  color: var(--primary-dark);
}


h1,h2{text-align:center;margin:0}
h1{font-size:2.2rem}
h2{font-size:1.6rem}

.sub{
  text-align:center;
  color:var(--muted);
  margin:8px 0 20px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:1.1rem;
  font-weight:600;
  background:var(--primary);
  color:white;
}
button.secondary{
  background:white;
  color:var(--text);
  border:2px solid #e0e0e0;
}
button:active{transform:scale(.98)}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(80px, 1fr));
  justify-content:center;
  gap:12px;
  margin:20px 0;
}

.player-btn {
  position: relative;
}

.player-btn::after {
  content: attr(data-num);
  position: absolute;
  top: 6px;
  right: 10px;
  font-size: 0.7rem;
  opacity: 0.6;
}
.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  margin:20px 0;
}

  @keyframes unlockPop {
  0% { transform: scale(0.95); box-shadow: none; }
  60% { transform: scale(1.05); box-shadow: 0 0 18px rgba(0,188,212,.6); }
  100% { transform: scale(1); box-shadow: none; }
}

button.unlock-animate {
  animation: unlockPop 0.4s ease;
}

input{
  width:100%;
  padding:14px;
  font-size:1rem;
  border-radius:12px;
  border:1.5px solid #ccc;
  margin-bottom:12px;
}

/* FLIP CARD */
.flip-wrap{
  perspective:1000px;
}
.flip{
  position:relative;
  width:100%;
  height:260px;
  transform-style:preserve-3d;
  transition:transform .6s;
}
.flip.revealed{transform:rotateY(180deg)}
.face{
  position:absolute;
  width:100%;
  height:100%;
  border-radius:20px;
  backface-visibility:hidden;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:20px;
  text-align:center;
}
.front{
  background:var(--primary);
  color:white;
}
.back{
  transform:rotateY(180deg);
  background:var(--primary);
  color:white;
}
.saboteur .back{
  background:black;
  filter:grayscale(1);
}

/* Eye icon */
.eye{
  width:56px;
  height:56px;
  border-radius:50%;
  background:rgba(255,255,255,.2);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  margin-bottom:12px;
}

.scale{
  display:flex;
  gap:4px;
  margin:12px 0;
}
.scale div{
  flex:1;
  background: var(--primary);
  color: white;
  border-radius:6px;
  font-weight:600;
  padding: 8px;

  display:flex;
  align-items:center;
  justify-content:center;
}
.scale .dark{background:var(--primary);color:white}

.footer{
  text-align:center;
  margin-top:16px;
  font-size:.9rem;
  color:var(--muted);
}

  #home .grid {
  justify-items: center;
}

#home .grid button {
  width: 100%;
  max-width: 260px;
}

  .btn-small {
  width: 44px;
  height: 44px;
  padding: 0;
  font-size: 1.2rem;
  border-radius: 12px;
}

.category-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;

  padding: 12px;
  min-height: 64px;

  white-space: normal;
  overflow-wrap: normal;   
  word-break: normal;      /* NEVER break words */

  line-height: 1.25;
}

  #imposterNameInputs input {
  margin-bottom: 18px;
}
.imposter-card {
  background: black;
  color: white;
  width: 100%;
  height: 100%;
  border-radius: 20px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
  .button-stack button + button {
  margin-top: 12px;
}
.word-label {
  color: rgba(255,255,255,0.85);
  font-size: 0.95rem;
  margin-bottom: 4px;
}

.secret-word {
  color: white;
  margin-top: -4;

}
.category-btn {
  transition:
    transform 0.15s ease,
    box-shadow 0.15s ease,
    background 0.15s ease;
}

 #categoryGrid {
  grid-template-columns: repeat(2, 1fr);
}
  /* Exit transitions */
.screen.exit-left {
  opacity: 0;
  transform: translateX(-24px);
}

.screen.exit-right {
  opacity: 0;
  transform: translateX(24px);
}
  /* FORCE CATEGORY BUTTONS TO FILL SPACE */
#categoryGrid button {
  max-width: 100%;       /* Override the 90px limit */
  width: 100%;           /* Fill the grid cell */
  min-height: 70px;      /* Make them tall enough for 2 lines of text */
  padding: 8px;          /* Adjust padding */
  font-size: 0.95rem;    /* Slightly smaller text to fit long words */
}

 .imposter-card.civilian {
  background: var(--primary);
  color: white;
  box-shadow: 0 10px 26px rgba(0,188,212,0.45);
}


.imposter-card.imposter {
  background: linear-gradient(135deg, #b71c1c, #e53935); /* red */
  color: white;
}


/* Smooth but noticeable pulse */
@keyframes categoryGlowPulse {
  0%, 100% {
    box-shadow:
      0 0 0 3px rgba(0,188,212,0.85),
      0 0 20px rgba(0,188,212,0.9),
      0 0 40px rgba(0,188,212,0.7),
      0 0 70px rgba(0,188,212,0.5);
  }
  50% {
    box-shadow:
      0 0 0 4px rgba(0,188,212,1),
      0 0 28px rgba(0,188,212,1),
      0 0 55px rgba(0,188,212,0.85),
      0 0 90px rgba(0,188,212,0.65);
  }
}

  .stack {
  display: flex;
  flex-direction: column;
  gap: 14px;
  margin-top: 20px;
}

  .card-inner {
  position: relative;
  transform-style: preserve-3d;
  transition: transform 0.6s;
}

.card-inner.flipped {
  transform: rotateY(180deg);
}

.card-front,
.card-back {
  backface-visibility: hidden;
}

.card-back {
  transform: rotateY(180deg);
}

.category-btn.active {
  background: var(--primary);
  color: white;

  /* REMOVE SCALE */
  transform: none;

  box-shadow:
    0 0 0 3px rgba(0,188,212,0.9),
    0 0 18px rgba(0,188,212,0.85),
    0 0 36px rgba(0,188,212,0.75);

  animation: none;
}

  .timer {
  font-size: 1.8em;
  font-weight: bold;
  color: var(--primary);
  margin: 12px 0;
  text-align: center;
}

.role-reminders {
  margin-top: 14px;
  font-size: 0.95em;
  opacity: 0.9;
}
.role-reminder {
  margin: 6px 0;
}
.blue-card {
  background: linear-gradient(145deg, #00bcd4, #0097a7);
  color: white;
}
.big-card {
  width: 90%;
  max-width: 380px;
}
.big-text {
  font-size: 2em;
  margin-top: 10px;
}
  .card select {
  width: 100%;
}

  .chaos-box {
  margin: 16px 0;
  padding: 14px;
  border-radius: 12px;
  background: linear-gradient(145deg, #ff7043, #ff5722);
  color: white;
  text-align: center;
  box-shadow: 0 0 16px rgba(255,87,34,0.6);
}

.chaos-box h3 {
  margin-bottom: 6px;
}

.hidden {
  display: none;
}

</style>
</head>

<body>
<!-- HOME / HUB -->
<div class="screen active" id="home">
  <h1>Pass n' Play!</h1>
  <div class="sub">
    Fun party games that only require one screen
  </div>

  <div class="card">
    <h2>Games</h2>

    <div class="grid">
      <button onclick="launchSecretSaboteur()">
        üîç Secret Saboteur
      </button>
      <button onclick="launchImposter()">üïµÔ∏è Imposter</button>
     <button class="game-btn" onclick="resetRoleRoulette(); show('role-setup')">
  üé≠ Role Roulette
</button>
    </div>
  </div>
</div>

<!-- INTRO -->
<div class="screen" id="intro">
  
  <h1>Secret Saboteur</h1>
  <div class="sub">A social deduction party game</div>

  <div class="card">
    <h2>How many players?</h2>
    <div class="grid" id="playerGrid"></div>
    <div class="footer">Select 3‚Äì10 players to start</div>
  </div>
 <div class="intro-info">
  <button class="info-btn" onclick="showRules()">?</button>
</div>
</div>

<!-- NAMES -->
<div class="screen" id="names">
  <h2>Enter Player Names</h2>
  <div class="sub">Who‚Äôs playing today?</div>
  <div class="card" id="nameInputs"></div>
 
  <div id="saboteurSelect" class="card hidden">
  <h3 style="text-align:center">Number of Saboteurs</h3>
  <div class="grid" id="saboteurCountGrid"></div>
</div>
  
 <button onclick="confirmSaboteurAndStart()">Continue ‚Üí</button>
</div>

<!-- ROLE -->
<div class="screen" id="role">
  <div class="sub">Pass the device to</div>
  <h2 id="currentName"></h2>

  <div class="flip-wrap">
    <div class="flip" id="flipCard" onclick="toggleFlip()">
      <div class="face front">
        <h2>Tap to Reveal</h2>
      </div>
      <div class="face back" id="roleBack"></div>
    </div>
  </div>

  <button onclick="nextPlayer()">Next Player</button>
</div>

<!-- DISCUSSION -->
<div class="screen" id="discussion">
  <h2>Discussion Time</h2>
  <h3 id="saboteurDiscussionStarter" style="text-align:center;margin-top:8px"></h3>

  <div class="sub">Each player gives an answer</div>

  <h3 id="promptText"></h3>
  <div class="card">
    <div class="scale" id="scaleBar"></div>
    <div style="display:flex;justify-content:space-between">
      <small id="lowLabel"></small>
      <small id="highLabel"></small>
    </div>
  </div>

 <button class="secondary small-btn" onclick="rerollPrompt()">‚Üª New Prompt</button>
<button onclick="toGuess()">Continue to Guess ‚Üí</button>
</div>

<!-- GUESS -->
<div class="screen" id="guess">
  <h2>Guesser</h2>
  <div class="sub" id="guessPrompt"></div>
  <div id="likelihoodHint" class="likelihood-hint"></div>
<h3 style="text-align:center">1. Guess the Number</h3>
  <div class="grid">
     <button class="player-btn" onclick="makeGuess(1)">1</button>
  <button class="player-btn" onclick="makeGuess(2)">2</button>
  <button class="player-btn" onclick="makeGuess(3)">3</button>
  <button class="player-btn" onclick="makeGuess(4)">4</button>
  <button class="player-btn" onclick="makeGuess(5)">5</button>
  <button class="player-btn" onclick="makeGuess(6)">6</button>
  <button class="player-btn" onclick="makeGuess(7)">7</button>
  <button class="player-btn" onclick="makeGuess(8)">8</button>
  <button class="player-btn" onclick="makeGuess(9)">9</button>
  <button class="player-btn" onclick="makeGuess(10)">10</button>
  </div>

  <div class="card">
  <h3 style="text-align:center">2. Guess the Saboteur</h3>
  <div id="saboteurChoices" class="grid"></div>
</div>

<button id="submitGuessBtn" onclick="submitGuess()" disabled>
  Submit Guess
</button>
  
</div>

<!-- RESULTS -->
<div class="screen" id="results">
  <h2>Results</h2>
  <div class="card">
    <h2 id="resultMessage"></h2>
    <p id="resultText" style="font-weight:700;font-size:1.2rem;text-align:center"></p>
    <p>The number was <b id="realNum"></b></p>
    <p>Guesser said <b id="guessNum"></b></p>
  </div>

  <div class="card sab-card">
  Saboteur was <b id="sabName"></b>

  <button class="info-btn" onclick="showSaboteurInfo()">?</button>
</div>

  <button onclick="playAgain()">‚Üª Play Again</button>
  <button class="secondary" onclick="resetGame()">New Game</button>
</div>

  <div class="screen" id="imposter-setup">
  <h1>Imposter</h1>
  <div class="sub">Secret word social deduction</div>

  <div class="card">
    <h2>Players</h2>
    <div style="display:flex;align-items:center;justify-content:center;gap:12px;">
      <button class="btn-small" onclick="changeImposterPlayers(-1)">‚àí</button>
      <div id="imposterPlayerCount" style="font-size:1.4rem;font-weight:700;">3</div>
      <button class="btn-small" onclick="changeImposterPlayers(1)">+</button>
    </div>
  </div>

 <div class="card">
  <h2>Categories</h2>

 <div class="grid" id="categoryGrid">
  <button class="category-btn active" data-cat="objects">Everyday Objects</button>
  <button class="category-btn" data-cat="food">Food & Drinks</button>
  <button class="category-btn" data-cat="animals">Animals</button>
  <button class="category-btn" data-cat="colors">Colors</button>
  <button class="category-btn" data-cat="shapes">Shapes</button>
  <button class="category-btn" data-cat="emotions">Emotions<br>& Feelings</button>
  <button class="category-btn" data-cat="music">Music</button>
  <button class="category-btn" data-cat="brands">Brands</button>
  <button class="category-btn" data-cat="hobbies">Hobbies & Sports</button>
  <button class="category-btn" data-cat="movies">Movies & TV</button>
  <button class="category-btn" data-cat="jobs">Occupations</button>
  <button class="category-btn" data-cat="nature">Weather & Nature</button>
  <button class="category-btn" data-cat="science">Science & Tech</button>
  <button class="category-btn" data-cat="transport">Transportation</button>
</div>


  <button onclick="startImposterNames()">Start Game ‚Üí</button>
   <div class="intro-info">
  <button class="info-btn" onclick="showImposterRules()">?</button>
</div>
</div>
    </div> 
  
<div class="screen" id="imposter-names">
  <h2>Players & Imposters</h2>

  <div class="card" id="imposterNameInputs"></div>

  <div class="card">
    <h3>Imposters</h3>
    <div style="display:flex;align-items:center;justify-content:center;gap:12px;">
      <button onclick="changeImposterCount(-1)">‚àí</button>
      <div id="imposterCountDisplay">1</div>
      <button onclick="changeImposterCount(1)">+</button>
    </div>
    <div class="sub" id="imposterLimitText"></div>
  </div>

  <button onclick="startImposterRoles()">Continue ‚Üí</button>
</div>

  <div class="screen" id="imposter-role">
  <div class="sub">Pass the device to</div>
  <h2 id="imposterCurrentName"></h2>

  <div class="flip-wrap">
    <div class="flip" id="imposterFlip" onclick="toggleImposterFlip()">
      <div class="face front">
        <h2>Tap to Reveal</h2>
      </div>
      <div class="face back" id="imposterRoleBack"></div>
    </div>
  </div>

  <button style="margin-top:20px" onclick="nextImposterPlayer()">Next Player</button>
</div>

 <div class="screen" id="imposter-discussion">
  <h2>Discussion Time</h2>
   <h3 id="imposterDiscussionStarter" style="text-align:center;margin-top:8px"></h3>

  <div class="card">
    <p><b>Game started!</b></p>
    <p>Discuss and catch the imposter.</p>
  </div>

  <button onclick="revealImposter()">Reveal Imposter</button>
</div>

  <div class="screen" id="imposter-results">
  <h2>Results</h2>

  <div class="card" style="text-align:center;">
  <p>The word was:</p>
  <h2 id="imposterWordReveal"></h2>
</div>

<div class="card" style="background:black;color:white;text-align:center;">
  <p>Imposter(s):</p>
  <h3 id="imposterList"></h3>
</div>
<div class="button-stack">
  <button onclick="launchImposter()">‚Üª Play Again</button>
  <button class="secondary" onclick="show('home')">Back to Hub</button>
</div>
</div>

<!-- ROLE ROULETTE SETUP -->
<div class="screen" id="role-setup">
  <h1>Role Roulette</h1>
  <div class="sub">Act the part. Don‚Äôt get caught.</div>

 <div class="card">
    <h2>Players</h2>
    <div style="display:flex;align-items:center;justify-content:center;gap:12px;">
      <button class="btn-small" onclick="changeRolePlayers(-1)">‚àí</button>
      <div id="rolePlayerCount" style="font-size:1.4rem;font-weight:700;">3</div>
      <button class="btn-small" onclick="changeRolePlayers(1)">+</button>
    </div>
  </div>

 <div class="stack">
  <button onclick="startRoleNames()">Start Game ‚Üí</button>
  <button class="secondary" onclick="show('home')">Back</button>
   <button class="info-btn" onclick="openRoleInfo()">?</button>
</div>
</div>

  
<div class="screen" id="role-names">
  <h1>Player Names</h1>
  <div id="roleNames"></div>
  <button onclick="startRoleRoles()">Continue ‚Üí</button>
</div>

<!-- ROLE CARD -->
  <div class="screen" id="role-card">
  <div class="sub">Pass the device to</div>
  <h2 id="rolePlayerTitle"></h2>

  <div class="flip-wrap">
    <div class="flip" id="flipCard" onclick="toggleRoleFlip()">
      <div class="face front">
        <h2>Tap to Reveal</h2>
      </div>
      <div class="face back" id="roleText"></div>
    </div>
  </div>
  

  <button onclick="nextRolePlayer()">Next Player</button>
</div>

 
</div>
  
<div class="screen" id="role-discussion">
  <h1>All Roles Assigned</h1>
  <div class="sub">Discuss and guess who played which role</div>
  <div id="roleTimer" class="timer">05:00</div>
  <div id="chaosBox" class="chaos-box hidden">
  <h3 id="chaosTitle"></h3>
  <p id="chaosText"></p>
</div>

<button class="secondary" onclick="triggerChaos()">üé≤ Chaos Modifier</button>

  <p id="roleDiscussionPrompt" style="text-align:center;font-weight:600;"></p>
<button class="secondary small-btn" onclick="rerollRolePrompt()">‚Üª New Prompt</button>
  <div id="roleReminders" class="role-reminders"></div>


  <div id="roleGuessList"></div>

  <button onclick="showRoleResults()">Reveal Roles ‚Üí</button>
</div>

  <div class="screen" id="role-results">
  <h1>Roles Revealed</h1>

  <div id="roleResults"></div>

  <button onclick="resetRoleRoulette(); show('home')">Back to Hub</button>
</div>
<script>
/* --- DATA --- */
const prompts = [
  { title: "Reasons to call 911", low: "Reasonable", high: "Ridiculous" },
  { title: "Places to nap", low: "Very comfortable", high: "Very uncomfortable" },
  { title: "Cool for a high-schooler", low: "Not cool", high: "Cool" },
  { title: "Things to discover in your pocket", low: "Exciting", high: "Not exciting" },
  { title: "Last words", low: "Forgettable", high: "Memorable" },
  { title: "Movies", low: "Relaxing", high: "Intense" },
  { title: "TV shows", low: "Serious", high: "Relaxing" },
  { title: "Food to eat at 7am", low: "Good", high: "Bad" },
  { title: "Places for summer vacation", low: "Worst", high: "Best" },
  { title: "Times to do homework", low: "Good", high: "Bad" },
  { title: "Excuses to leave a party early", low: "Believable", high: "Unbelievable" },
  { title: "Things you should never Google", low: "Harmless", high: "Traumatizing" },
  { title: "Things that ruin your day", low: "Minor", high: "Devastating" },
  { title: "Reasons to cancel plans", low: "Acceptable", high: "Unforgivable" },
  { title: "School supplies", low: "Useless", high: "Essential" },
  { title: "Ways to get suspended", low: "Understandable", high: "Stupid" },
  { title: "Things to do in class when bored", low: "Quiet", high: "Disruptive" },
  { title: "Clubs to join", low: "Boring", high: "Fun" },
  { title: "Times to laugh", low: "Appropriate", high: "Inappropriate" },
  { title: "Things to accidentally text your teacher", low: "Fine", high: "Horrifying" },
  { title: "Icebreakers", low: "Boring", high: "Painfully awkward" },
  { title: "Foods to bring to a potluck", low: "Welcomed", high: "Questioned" },
  { title: "Midnight snacks", low: "Normal", high: "Concerning" },
  { title: "Foods to eat in class", low: "Stealthy", high: "Obvious" },
  { title: "Foods that should never be microwaved", low: "Bad", high: "War crime" },
  { title: "Restaurant orders", low: "Safe", high: "Risky" },
  { title: "Places to sit", low: "Comfortable", high: "Miserable" },
  { title: "Sounds to fall asleep to", low: "Soothing", high: "Unbearable" },
  { title: "Clothes to sleep in", low: "Comfy", high: "A mistake" },
  { title: "Weather to walk in", low: "Pleasant", high: "Brutal" },
  { title: "Times to wake up", low: "Ideal", high: "Cruel" },
  { title: "Things to yell in a library", low: "Quiet", high: "Unacceptable" },
  { title: "Places to lose your phone", low: "Recoverable", high: "Hopeless" },
  { title: "Ways to get famous", low: "Respectable", high: "Infamous" },
  { title: "Lies", low: "Believable", high: "Terrible" },
  { title: "Secrets", low: "Harmless", high: "Life-ruining" },
  { title: "Bad ideas", low: "Questionable", high: "Catastrophic" },
  { title: "Social mistakes", low: "Forgivable", high: "Unforgettable" },
  { title: "Times to leave", low: "Polite", high: "Dramatic" },
  { title: "Things to do instead of studying", low: "Understandable", high: "Irresponsible" },
  { title: "Things that make you instantly cringe", low: "Mild", high: "Physically painful" },
  { title: "Things to hear right before a test", low: "Comforting", high: "Terrifying" },
  { title: "Things to forget at a sleepover", low: "No big deal", high: "Friendship-ending" },
  { title: "Things that should never be said in a group chat", low: "Awkward", high: "Nuclear" },
  { title: "Things that feel like a scam", low: "Suspicious", high: "Obviously fake" },
  { title: "Things that make a teacher pause", low: "Confusing", high: "Concerning" },
  { title: "Things that feel illegal to do alone", low: "A little weird", high: "Extremely alarming" },
  { title: "Things to say when you don't hear someone", low: "Polite", high: "Unhinged" },
  { title: "Things that ruin a vibe instantly", low: "Buzzkill", high: "Atmosphere destroyer" },
  { title: "Things that make a room go silent", low: "Unexpected", high: "Catastrophic" },
  { title: "Things to bring to a group project meeting", low: "Helpful", high: "Pointless" },
  { title: "Things that shouldn't be competitive", low: "Odd", high: "Unhinged" },
  { title: "Things that feel personal but aren't", low: "Slightly invasive", high: "Way too much" },
  { title: "Things to be late to", low: "Forgivable", high: "Unacceptable" },
  { title: "Things to say when someone trips", low: "Supportive", high: "Evil" },
  { title: "Things that feel louder than they are", low: "Noticeable", high: "Deafening" },
  { title: "Things that make you rethink a friendship", low: "Questionable", high: "Dealbreaker" },
  { title: "Things to overhear on public transit", low: "Boring", high: "Life-changing" },
  { title: "Things that shouldn't have lore", low: "Odd", high: "Deeply unsettling" },
  { title: "Things that make waiting worse", low: "Annoying", high: "Unbearable" },
  { title: "Things that feel like a jump scare", low: "Startling", high: "Heart attack" },
  { title: "Things that shouldn't be sticky", low: "Annoying", high: "Horrifying" },
  { title: "Things to say during a presentation", low: "Recoverable", high: "Career-ending" },
  { title: "Things that make you immediately apologize", low: "Oops", high: "I'm so sorry" },
  { title: "Things to notice too late", low: "Inconvenient", high: "Disastrous" },
  { title: "Things that feel illegal at night", low: "Suspicious", high: "Terrifying" },
  { title: "Things that should not be whispered", low: "Strange", high: "Threatening" },
  { title: "Things to hear from the next room", low: "Confusing", high: "Alarming" },
  { title: "Things that make silence worse", low: "Awkward", high: "Unbearable" },
  { title: "Things that ruin confidence instantly", low: "Doubt-inducing", high: "Soul-crushing" },
  { title: "Things to bring up at the wrong time", low: "Awkward", high: "Unforgivable" },
  { title: "Things that feel cursed", low: "Off-putting", high: "Actively haunted" },
  { title: "Things that shouldn't make noise", low: "Annoying", high: "Terrifying" },
  { title: "Things to forget you're holding", low: "Embarrassing", high: "Dangerous" },
  { title: "Things that make you question reality", low: "Confusing", high: "Existential crisis" },
  { title: "Things that feel awkward way too fast", low: "Mild", high: "Unbearable" },
  { title: "Things that feel illegal but aren't", low: "Suspicious", high: "Heart-racing" },
  { title: "Things that ruin concentration instantly", low: "Distracting", high: "Impossible" },
  { title: "Things you shouldn't clap for", low: "Odd", high: "Unhinged" },
  { title: "Things that feel colder than expected", low: "Chilly", high: "Freezing" },
  { title: "Spicy foods", low: "No heat", high: "Tongue-numbing" },
  { title: "Meals to have at 8pm", low: "Normal", high: "Very Unusual" },
  { title: "Things that make people stare", low: "Curious", high: "Alarmed" },
  { title: "Things that feel too personal to ask", low: "Awkward", high: "Unacceptable" },
  { title: "Things that feel fake even when real", low: "Suspicious", high: "Impossible" },
  { title: "Things that ruin a good mood", low: "Minor", high: "Day-ending" },
  { title: "Things that feel wrong at night", low: "Weird", high: "Terrifying" },
  { title: "Things that feel dramatic for no reason", low: "Extra", high: "Unhinged" },
  { title: "Phrases taken out of context", low: "Funny", high: "Irredeemable" },
  { title: "Things that feel longer than they are", low: "Dragging", high: "Endless" },
  { title: "Things that feel rude but aren't", low: "Blunt", high: "Savage" },
  { title: "Amusement park attractions", low: "Boring", high: "Adrenaline-inducing" },
  { title: "Things that feel illegal in public", low: "Embarrassing", high: "Unthinkable" },
  { title: "Things that feel suspiciously quiet", low: "Calm", high: "Ominous" },
  { title: "Things that feel too powerful", low: "Impressive", high: "Terrifying" },
  { title: "Things that feel unsafe emotionally", low: "Awkward", high: "Devastating" },
  { title: "Things to bring to a potluck", low: "Fav contributiuon", high: "Shameful" },
  { title: "Things that feel worse when watched", low: "Uncomfortable", high: "Impossible" },
  { title: "Things that feel fake-polite", low: "Forced", high: "Painful" },
  { title: "Things to be popular for", low: "Proud", high: "Embarrassing" },
  { title: "Boiled foods", low: "Yum!", high: "Why!?!" },
  { title: "Things that feel like a trap", low: "Suspicious", high: "Certain doom" },
  { title: "Things that feel oddly threatening", low: "Unsettling", high: "Terrifying" },
  { title: "Things that feel wrong immediately", low: "Off", high: "Alarming" },
  { title: "Things that feel too intense too fast", low: "Strong", high: "Overwhelming" }
];

let players=[],roles=[],count=0,idx=0,number=0,guess=0,round=1;

let guessedNobody = false;
let saboteurCount = 1;
let guessedNumber = null;
let guessedSaboteurs = [];
let submitWasDisabled = true;
let showLikelihoodHint = false;
let discussionStarterIndex = null;
let selectedCategories = new Set(["objects"]); // default
let roleGuesses = {}; // { playerName: guessedRole }

/* --- AUDIO --- */
const sounds = {
  flip: new Audio("flipcard-91468.mp3"),
  correct: new Audio("crowd_small_chil_ec049202_9klCwI6.mp3"),
  wrong: new Audio("buzzer-or-wrong-answer-20582.mp3")
};

/* --- FLOW NAVIGATION --- */
function show(id, direction = "right") {
  document.querySelectorAll(".screen").forEach(s => {
    s.classList.remove("active", "exit", "from-left", "from-right");
    s.style.display = "none";
  });

  const next = document.getElementById(id);
  if (!next) {
    console.error(`Screen not found: ${id}`);
    return;
  }

  next.style.display = "block";
  next.classList.add("active");
  next.classList.add(direction === "right" ? "from-right" : "from-left");

  requestAnimationFrame(() => {
    next.classList.remove("from-right", "from-left");
  });
}


function launchSecretSaboteur() {
  resetGame();      
  show('intro');    
}

function launchImposter() {
  imposterPlayers = 3;
  imposterCount = 1; 
  imposterIndex = 0;
  show("imposter-setup");
  updateImposterPlayerUI();
}

function resetGame(){
  round = 1;
  players = [];
  roles = [];
  idx = 0;
  guessedNumber = null;
  guessedSaboteurs = [];
  guessedNobody = false;
  show("home");
}

/* --- SECRET SABOTEUR LOGIC --- */

// Initial Player Selection
const grid=document.getElementById('playerGrid');
for(let i = 3; i <= 10; i++) {
  const btn = document.createElement("button");
  btn.textContent = i;
  btn.onclick = () => selectPlayers(i);
  grid.appendChild(btn);
}

function selectPlayers(n){
  count = n;
  show('names');

  const wrap = document.getElementById('nameInputs');
  wrap.innerHTML = '';

  for(let i = 0; i < n; i++){
    wrap.innerHTML += `<input value="Player ${i+1}">`;
  }

  const sabBox = document.getElementById('saboteurSelect');
  sabBox.classList.remove('hidden');

  setupSaboteurCountSelect();
  saboteurCount = 1; // default
}

function setupSaboteurCountSelect(){
  const maxSab = getMaxSaboteurs(count);
  const container = document.getElementById("saboteurCountGrid");
  container.innerHTML = "";

  for (let i = 1; i <= maxSab; i++){
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.onclick = () => {
      saboteurCount = i;
      document
        .querySelectorAll("#saboteurCountGrid button")
        .forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    };

    if (i === 1) btn.classList.add("selected"); 
    container.appendChild(btn);
  }
}

function getMaxSaboteurs(playerCount){
  if (playerCount >= 10) return 4;
  if (playerCount >= 8) return 3;
  if (playerCount >= 6) return 2;
  return 1;
}

function confirmSaboteurAndStart(){
  if (!saboteurCount) {
    alert("Please select the number of Saboteurs.");
    return;
  }
  startRound();
}

// Role Distribution Logic
function getActualSaboteurCount(maxSaboteurs) {
  const roll = Math.random() * 100;
  const tables = {
    1: [{ count: 0, chance: 20 }, { count: 1, chance: 80 }],
    2: [{ count: 0, chance: 10 }, { count: 1, chance: 30 }, { count: 2, chance: 60 }],
    3: [{ count: 0, chance: 5 }, { count: 1, chance: 15 }, { count: 2, chance: 20 }, { count: 3, chance: 60 }],
    4: [{ count: 0, chance: 1 }, { count: 1, chance: 15 }, { count: 2, chance: 16 }, { count: 3, chance: 18 }, { count: 4, chance: 50 }]
  };

  let cumulative = 0;
  for (const entry of tables[maxSaboteurs]) {
    cumulative += entry.chance;
    if (roll <= cumulative) return entry.count;
  }
  return maxSaboteurs; 
}

function startRound(){
  players=[...document.querySelectorAll('#nameInputs input')].map(i=>i.value||'Player');
  roles = Array(count).fill('teammate');

  const guesserIndex = Math.floor(Math.random() * count);
  roles[guesserIndex] = 'guesser';

  let available = [...Array(count).keys()].filter(i => i !== guesserIndex);
  const actualSaboteurCount = Math.min(getActualSaboteurCount(saboteurCount), available.length);

  for (let i = 0; i < actualSaboteurCount; i++) {
    const pick = Math.floor(Math.random() * available.length);
    roles[available[pick]] = "saboteur";
    available.splice(pick, 1);
  }
  
  number=Math.floor(Math.random()*10)+1;
  idx=0;
  showRole();
}

function showRole(){
  document.getElementById('currentName').textContent=players[idx];
  const back=document.getElementById('roleBack');
  const role=roles[idx];
  const flip = back.parentElement;
  
  flip.classList.remove('saboteur');
  if (role === 'saboteur') flip.classList.add('saboteur');
  
  back.innerHTML=`
    <div class="eye">üëÅÔ∏è</div>
    <h2>${role.toUpperCase()}</h2>
    <p>${role==='teammate'?'Help the Guesser!':role==='saboteur'?'Mislead the group!':'Show everyone your role, you are guessing the number!'}</p>
    ${role!=='guesser'?`<h1>${number}</h1>`:''}
  `;
  document.getElementById('flipCard').classList.remove('revealed');
  show('role');
}

function nextPlayer(){
  idx++;
  if(idx<count) showRole();
  else startDiscussion();
}

function toggleFlip() {
  if (sounds.flip && sounds.flip.src) {
    sounds.flip.play().catch(() => {});
  }
  document.getElementById('flipCard').classList.toggle('revealed');
}

// Discussion & Game Loop
function startDiscussion(){
   const eligible = roles
    .map((r, i) => r !== "guesser" ? i : null)
    .filter(i => i !== null);

  discussionStarterIndex = eligible[Math.floor(Math.random() * eligible.length)];
  
  const scale = document.getElementById("scaleBar");
  if (scale) {
    scale.style.animation = "none";
    scale.offsetHeight;
    scale.style.animation = "";
  }
  
  const p=prompts[Math.floor(Math.random()*prompts.length)];
  window.curPrompt=p;
  document.getElementById('promptText').textContent=p.title;
  document.getElementById('lowLabel').textContent=p.low;
  document.getElementById('highLabel').textContent=p.high;
  document.getElementById('scaleBar').innerHTML='';
  for (let i = 1; i <= 10; i++) {
    document.getElementById('scaleBar').innerHTML += `<div>${i}</div>`;
  }
  
  const hintEl = document.getElementById("likelihoodHint");
  if (showLikelihoodHint) {
    hintEl.textContent = `Saboteur likelihood: ${getSaboteurLikelihood()}`;
    hintEl.style.display = "block";
  } else {
    hintEl.style.display = "none";
  }
  
  document.getElementById("saboteurDiscussionStarter").innerHTML =
  `<strong>${players[discussionStarterIndex]}</strong> starts the discussion`;

  show('discussion');
  pulseScale();
}

function getSaboteurLikelihood() {
  if (saboteurCount <= 1) return "Low";
  if (saboteurCount === 2) return "High";
  return "Very High";
}

function rerollPrompt() {
  startDiscussion();
}

function pulseScale() {
  const items = document.querySelectorAll('#scaleBar div');
  items.forEach((el, i) => {
    setTimeout(() => {
      el.classList.add('pulse');
      setTimeout(() => el.classList.remove('pulse'), 400);
    }, i * 120);
  });
}

// Guessing Logic
function toGuess() {
  document.getElementById('guessPrompt').textContent = curPrompt.title;

  guessedNumber = null;
  guessedSaboteurs = [];
  guessedNobody = false;
  submitWasDisabled = true;

  setupSaboteurChoices();
  updateSubmitButton();

  show('guess');
}

function makeGuess(n){
  guessedNumber = n;

  document.querySelectorAll("#guess .player-btn").forEach(b => b.classList.remove("selected"));
  const btns = document.querySelectorAll("#guess .player-btn");
  btns[n - 1]?.classList.add("selected");

  updateSubmitButton();
}

function setupSaboteurChoices() {
  const wrap = document.getElementById("saboteurChoices");
  wrap.innerHTML = "";

  players.forEach((name, i) => {
    const btn = document.createElement("button");
    btn.textContent = name;
    btn.onclick = () => selectSaboteur(i, btn);
    wrap.appendChild(btn);
  });

  const nobodyBtn = document.createElement("button");
  nobodyBtn.textContent = "Nobody";
  nobodyBtn.onclick = () => selectSaboteur(null, nobodyBtn);
  wrap.appendChild(nobodyBtn);
}

function selectSaboteur(index, btn) {
 if (index === null) {
  guessedSaboteurs = [];
  guessedNobody = true;

  document.querySelectorAll("#saboteurChoices button").forEach(b => b.classList.remove("selected"));
  btn.classList.add("selected");
  updateSubmitButton();
  return;
}

 document.querySelectorAll("#saboteurChoices button").forEach(b => {
    if (b.textContent === "Nobody") b.classList.remove("selected");
  });

  guessedNobody = false;
  const existingIndex = guessedSaboteurs.indexOf(index);

  if (existingIndex !== -1) {
    guessedSaboteurs.splice(existingIndex, 1);
    btn.classList.remove("selected");
  } 
  else {
    if (guessedSaboteurs.length >= saboteurCount) {
      btn.classList.add("shake");
      setTimeout(() => btn.classList.remove("shake"), 300);
      return;
    }
    guessedSaboteurs.push(index);
    btn.classList.add("selected");
  }

  updateSubmitButton();
}

function updateSubmitButton() {
  const btn = document.getElementById("submitGuessBtn");
  const numberReady = guessedNumber !== null;
  const saboteurReady = guessedNobody || (guessedSaboteurs.length > 0 && guessedSaboteurs.length <= saboteurCount);

  btn.disabled = !(numberReady && saboteurReady);
  if (!btn.disabled) triggerSubmitUnlock(btn);
}

function triggerSubmitUnlock(btn) {
  if (submitWasDisabled) {
    btn.classList.remove("unlock-animate");
    void btn.offsetWidth; 
    btn.classList.add("unlock-animate");
  }
  submitWasDisabled = false;
}

function submitGuess() {
  const correctNumber = guessedNumber === number;
  const saboteurIndices = roles.map((r, i) => r === "saboteur" ? i : null).filter(i => i !== null);
  let correctSaboteur;

  if (saboteurIndices.length === 0) {
    correctSaboteur = guessedNobody;
  } else {
    correctSaboteur = guessedNobody
      ? saboteurIndices.length === 0
      : saboteurIndices.length === guessedSaboteurs.length && saboteurIndices.every(i => guessedSaboteurs.includes(i));
  }

  const teammatesWin = correctNumber || correctSaboteur;
  if (teammatesWin) {
    launchConfetti();
  }
  document.getElementById("realNum").textContent = number;
  document.getElementById("guessNum").textContent = guessedNumber;

  document.getElementById("sabName").textContent =
    saboteurIndices.length ? saboteurIndices.map(i => players[i]).join(", ") : "Nobody";

  document.getElementById("resultText").textContent =
    correctNumber && correctSaboteur ? "Perfect! Number AND Saboteur guessed!"
      : teammatesWin ? "Teammates win!" : "Saboteurs win!";
        
  revealCorrectness(teammatesWin);
  show("results");
}

function revealCorrectness(teammatesWin) {
  const msg = document.getElementById("resultMessage");
  if (!msg) return;

  if (teammatesWin) {
    sounds.correct.play();
    msg.textContent = "‚úÖ Teammates Win!";
    msg.className = "correct";
  } else {
    sounds.wrong.play();
    msg.textContent = "‚ùå Saboteurs Win!";
    msg.className = "incorrect";
  }
}

function playAgain(){
  startRound();
}

/* === IMPOSTER GAME LOGIC === */

let imposterPlayers = 3;
let imposterNames = [];
let imposterRoles = [];
let imposterIndex = 0;
let imposterWord = "";
let imposterCount = 1;

// Word Banks
const wordBank = {
  objects: ["Chair","Table","Phone","Backpack","Mirror","Clock","Lamp","Notebook","Pen","Wallet","Keys","Bottle"],
  food: ["Pizza","Burger","Pasta","Rice","Soup","Sandwich","Salad","Tacos","Fries","Noodles","Ice Cream","Cake"],
  animals: ["Dog","Cat","Horse","Cow","Pig","Sheep","Goat","Chicken","Duck","Goose","Lion","Tiger"],
  colors: ["Red","Blue","Green","Yellow","Orange","Purple","Pink","Brown","Black","White","Gray","Beige"],
  shapes: ["Circle","Square","Triangle","Rectangle","Oval","Diamond","Star","Heart","Pentagon"],
  emotions: ["Happy","Sad","Angry","Excited","Nervous","Calm","Relaxed","Stressed","Anxious","Confident"],
  music: ["Song","Album","Playlist","Concert","Band","Singer","Guitar","Piano","Drums","Violin"],
  brands: ["Apple","Google","Samsung","Nike","Adidas","Puma","Coca-Cola","Pepsi","McDonald's"],
  hobbies: ["Gaming","Drawing","Painting","Reading","Writing","Cooking","Baking","Gardening"],
  movies: ["Inception","Titanic","Avatar","Frozen","Toy Story","The Matrix","Jurassic Park","Star Wars"],
  jobs: ["Doctor","Nurse","Teacher","Professor","Student","Engineer","Programmer","Developer"],
  nature: ["Rain","Snow","Hail","Sleet","Wind","Breeze","Storm","Thunder","Lightning","Fog"],
  science: ["Robot","AI","Computer","Internet","Algorithm","Code","Program","Software","Hardware"],
  transport: ["Car","Truck","Van","Bus","Taxi","Uber","Train","Subway","Metro","Tram"]
};

// Category Selection
document.querySelectorAll(".category-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const cat = btn.dataset.cat;
    btn.classList.toggle("active");
    if (selectedCategories.has(cat)) {
      selectedCategories.delete(cat);
    } else {
      selectedCategories.add(cat);
    }
    if (selectedCategories.size === 0) {
      selectedCategories.add(cat);
      btn.classList.add("active");
    }
  });
});

function calculateMaxImposters(playerCount) {
  return Math.ceil(playerCount / 5);
}

function updateImposterPlayerUI() {
  document.getElementById("imposterPlayerCount").textContent = imposterPlayers;
  const max = calculateMaxImposters(imposterPlayers);
  if (imposterCount > max) {
    imposterCount = max;
    document.getElementById("imposterCountDisplay").textContent = imposterCount;
  }
  document.getElementById("imposterLimitText").textContent = `Max imposters: ${max}`;
}

function changeImposterPlayers(delta) {
  imposterPlayers = Math.max(3, Math.min(20, imposterPlayers + delta));
  updateImposterPlayerUI();
}

function startImposterNames() {
  try {
    console.log("startImposterNames() called");

    // ensure imposterPlayers is a number (fall back to 3)
    let count = Number.isFinite(Number(imposterPlayers)) ? parseInt(imposterPlayers, 10) : 3;
    if (isNaN(count) || count < 3) count = 3;

    // reset state
    imposterNames = [];
    imposterRoles = [];
    imposterIndex = 0;

    // build inputs (update DOM first so we don't show an empty screen)
    const wrap = document.getElementById("imposterNameInputs");
    if (!wrap) {
      console.error("Could not find #imposterNameInputs");
      alert("Unexpected error: UI element missing (imposterNameInputs). Check console.");
      return;
    }

    let inputsHTML = "";
    for (let i = 0; i < count; i++) {
      // use name attribute + placeholder to be explicit
      inputsHTML += `<input type="text" name="imposterName${i}" value="Player ${i + 1}" placeholder="Player ${i+1}">`;
    }
    wrap.innerHTML = inputsHTML;

    // update limits / UI safely (call existing function which is declared later)
    if (typeof updateImposterLimit === "function") {
      updateImposterLimit();
    } else {
      // fallback ‚Äî ensure UI shows sane defaults
      const max = Math.ceil(count / 5);
      imposterCount = Math.min(Math.max(1, imposterCount || 1), max);
      const display = document.getElementById("imposterCountDisplay");
      if (display) display.textContent = imposterCount;
      const text = document.getElementById("imposterLimitText");
      if (text) text.textContent = `Max imposters: ${max}`;
    }

    // small reflow to ensure DOM is painted
    void wrap.offsetHeight;

    // finally show the screen (after DOM updated)
    show("imposter-names");
    console.log("startImposterNames() completed successfully");
  } catch (err) {
    console.error("Error in startImposterNames():", err);
    alert("Something went wrong starting the imposter setup ‚Äî open devtools console to see details.");
  }
}


function updateImposterLimit() {
  // Logic to determine max imposters based on player count
  const count = parseInt(imposterPlayers) || 3;
  
  // 3-5 players = 1 imposter
  // 6-10 players = 2 imposters
  // 11-15 players = 3 imposters
  // 16+ players = 4 imposters
  const maxLimit = Math.ceil(count / 5);

  // Ensure current imposters doesn't exceed max
  if (imposterCount > maxLimit) imposterCount = maxLimit;
  if (imposterCount < 1) imposterCount = 1;

  // Update UI
  const countDisplay = document.getElementById("imposterCountDisplay");
  const textDisplay = document.getElementById("imposterLimitText");
  
  if (countDisplay) countDisplay.textContent = imposterCount;
  if (textDisplay) textDisplay.textContent = `Max imposters: ${maxLimit}`;
}
  
function changeImposterCount(delta) {
  const maxImposters = calculateMaxImposters(imposterPlayers);
  imposterCount = Math.max(1, Math.min(maxImposters, imposterCount + delta));
  document.getElementById("imposterCountDisplay").textContent = imposterCount;
}

function getRandomImposterWord() {
  const pools = [...selectedCategories]
    .flatMap(cat => wordBank[cat] || []);
  return pools[Math.floor(Math.random() * pools.length)];
}

function startImposterRoles() {
  // 1. Collect names
  imposterNames = [...document.querySelectorAll("#imposterNameInputs input")]
    .map(i => i.value || "Player");

  const playerCount = imposterNames.length;
  const maxImposters = calculateMaxImposters(playerCount);
  const finalImposterCount = Math.min(imposterCount, maxImposters);

  // 2. Pick Word
  imposterWord = getRandomImposterWord();
  if(!imposterWord) imposterWord = "Pizza"; // Fallback

  // 3. Initialize roles
  imposterRoles = Array(playerCount).fill("crew");

  // 4. Assign Imposters
  let assigned = 0;
  while (assigned < finalImposterCount) {
    const idx = Math.floor(Math.random() * playerCount);
    if (imposterRoles[idx] === "crew") {
      imposterRoles[idx] = "imposter";
      assigned++;
    }
  }

  // 5. Start
  imposterIndex = 0;
  updateImposterCard();
  show("imposter-role");
}

function updateImposterCard() {
  document.getElementById("imposterCurrentName").textContent =
    imposterNames[imposterIndex];

  const back = document.getElementById("imposterRoleBack");

  if (imposterRoles[imposterIndex] === "imposter") {
    back.innerHTML = `
      <div class="imposter-card imposter">
        <h2>IMPOSTER</h2>
        <p>Blend in. Avoid detection.</p>
      </div>`;
  } else {
    back.innerHTML = `
      <div class="imposter-card civilian">
        <div class="word-label">The word is</div>
        <h2 class="secret-word">${imposterWord}</h2>
      </div>`;
  }

  document.getElementById("imposterFlip").classList.remove("revealed");
}


function toggleImposterFlip() {
  if (sounds.flip && sounds.flip.src) {
    sounds.flip.play().catch(() => {});
  }
  document.getElementById("imposterFlip").classList.toggle("revealed");
}
  
function nextImposterPlayer() {
  imposterIndex++;
  if (imposterIndex < imposterNames.length) {
    updateImposterCard();
  } else {
    document.getElementById("imposterDiscussionStarter").textContent = imposterNames[Math.floor(Math.random()*imposterNames.length)] + " starts!";
    show("imposter-discussion");
  }
}

function revealImposter() {
  document.getElementById("imposterWordReveal").textContent = imposterWord;
  const imposters = imposterRoles
    .map((r, i) => r === "imposter" ? imposterNames[i] : null)
    .filter(Boolean);
  document.getElementById("imposterList").textContent = imposters.join(", ");
  show("imposter-results");
}

/* --- UTILS / MISC --- */
function launchConfetti() {
  const wrap = document.createElement('div');
  wrap.className = 'confetti';
  for (let i = 0; i < 80; i++) {
    const c = document.createElement('span');
    c.style.left = Math.random() * 100 + 'vw';
    c.style.animationDelay = Math.random() * 0.4 + 's';
    wrap.appendChild(c);
  }
  document.body.appendChild(wrap);
  setTimeout(() => wrap.remove(), 2000);
}

function showSaboteurInfo() {
  const el = document.getElementById("sabPopup");
  if (el) el.classList.remove("hidden");
}

function closeSaboteurInfo() {
  const el = document.getElementById("sabPopup");
  if (el) el.classList.add("hidden");
}

function showRules() {
  const el = document.getElementById("rulesPopup");
  if (el) el.classList.remove("hidden");
}

function closeRules() {
  const el = document.getElementById("rulesPopup");
  if (el) el.classList.add("hidden");
}

function showImposterRules() {
  const el = document.getElementById("imposterRulesPopup");
  if (el) el.classList.remove("hidden");
}

function closeImposterRules() {
  const el = document.getElementById("imposterRulesPopup");
  if (el) el.classList.add("hidden");
}

function handleKey(e) {
  const key = e.key;
  if (key === "Escape") {
    closeRules();
    closeSaboteurInfo();
    return;
  }
  if (isActive("role")) {
    if (key === " " || key === "Enter") {
      e.preventDefault();
      toggleFlip();
    }
  }
  if (isActive("imposter-role")) {
    if (key === " " || key === "Enter") {
      e.preventDefault();
      toggleImposterFlip();
    }
  }
  if (isActive("discussion")) {
    if (key >= "1" && key <= "9") pulseNumber(+key);
    if (key === "0") pulseNumber(10);
    if (key === "Enter") toGuess();
  }
  if (isActive("guess")) {
    if (key >= "1" && key <= "9") makeGuess(+key);
    if (key === "0") makeGuess(10);
  }
  if (isActive("results") && key === "Enter") {
    playAgain();
  }
}

function isActive(id) {
  const el = document.getElementById(id);
  return el && el.classList.contains("active");
}

function pulseNumber(n) {
  const items = document.querySelectorAll("#scaleBar div");
  const el = items[n - 1];
  if (!el) return;
  el.classList.remove("pulse");
  el.offsetHeight; 
  el.classList.add("pulse");
}

function unlockAudio() {
  Object.values(sounds).forEach(s => {
    s.play().catch(()=>{});
    s.pause();
    s.currentTime = 0;
  });
  document.removeEventListener("click", unlockAudio);
}

document.addEventListener("click", unlockAudio);
document.addEventListener("keydown", handleKey);

const likelihoodToggle = document.getElementById("likelihoodToggle");
if (likelihoodToggle) {
  likelihoodToggle.addEventListener("change", e => {
    showLikelihoodHint = e.target.checked;
  });
}

let rolePlayerCount = 4;
let rolePlayers = [];
let currentRoleIndex = 0;

const roleBank = [
  "Over-Explainer",
  "Interruptor",
  "Question Dodger",
  "Contrarian",
  "Quiet Observer",
  "Chaos Agent"
];
  const roleDiscussionPrompts = [
   "Describe your ideal weekend ‚Äî go!",
  "Tell the group about a time you embarrassed yourself.",
  "What is your most controversial opinion (keep it light)?",
  "If you had to lie about one thing right now, what would it be?",
  "What is something you secretly judge people for?",
  "Tell a story ‚Äî true or fake, we won‚Äôt know yet.",
  "Convince the group you are the most trustworthy person here.",
  "Defend a terrible opinion like you believe it."
];

  const roleDescriptions = {
  "Liar": "Lie confidently and avoid being caught.",
  "Over-Explainer": "Give way too much detail.",
  "Silent Type": "Speak as little as possible.",
  "Interruptor": "Cut people off often.",
  "Devil‚Äôs Advocate": "Argue the opposite of the group.",
  "Leader": "Try to control the discussion."
};
  
  const roleChaosModifiers = [
  {
    title: "No Questions",
    text: "For the next minute, nobody is allowed to ask questions."
  },
  {
    title: "One-Word Answers",
    text: "For the next 3 responses, everyone can only answer with ONE word."
  },
  {
    title: "Spotlight",
    text: "Everyone must address the same player for the next 2 minutes."
  },
  {
    title: "Reverse Roles",
    text: "Act like the opposite of your role for 60 seconds."
  },
  {
    title: "Truth Bomb",
    text: "Each player must say ONE true statement about themselves."
  },
  {
    title: "Silence",
    text: "No one can speak for 10 seconds. Eye contact only."
  },
  {
    title: "Leader Swap",
    text: "A random player must lead the discussion for 1 minute."
  }
];

function changeRolePlayers(delta) {
  rolePlayerCount = Math.max(3, Math.min(12, rolePlayerCount + delta));
  document.getElementById("rolePlayerCount").textContent = rolePlayerCount;
}



function updateRoleCard() {
  document.getElementById("rolePlayerTitle").textContent =
  roleNames[currentRoleIndex];

  document.getElementById("roleText").textContent =
    rolePlayers[currentRoleIndex];

  document.getElementById("roleCardInner").classList.remove("flipped");
}

function flipRoleCard() {
  document.getElementById("roleCardInner").classList.toggle("flipped");
}


  function buildRoleNameInputs() {
  roleNames = [];
  const container = document.getElementById("roleNames");
  container.innerHTML = "";

  for (let i = 0; i < rolePlayerCount; i++) {
    const input = document.createElement("input");
    input.placeholder = `Player ${i + 1}`;
    input.oninput = () =>
      roleNames[i] = input.value || `Player ${i + 1}`;
    container.appendChild(input);
  }
}

  function openRoleInfo() {
  const popup = document.getElementById("roleRulesPopup");
  if (popup) popup.classList.remove("hidden");
}

function closeRoleInfo() {
  const popup = document.getElementById("roleRulesPopup");
  if (popup) popup.classList.add("hidden");
}

  let roleNames = [];

function startRoleNames() {
  roleNames = [];
  currentRoleIndex = 0;

  buildRoleNameInputs();
  show("role-names");
}

  function toggleRoleFlip() {
  document.getElementById("roleCardInner").classList.toggle("flipped");
}

  function startRoleRoles() {
  roleNames = [...document.querySelectorAll("#roleNames input")]
    .map((i, idx) => i.value || `Player ${idx + 1}`);

  const shuffledRoles = [...roleBank].sort(() => Math.random() - 0.5);
  rolePlayers = roleNames.map((_, i) => shuffledRoles[i % shuffledRoles.length]);

  currentRoleIndex = 0;
  updateRoleCard();
  show("role-card");
}

  function nextRolePlayer() {
  currentRoleIndex++;

  if (currentRoleIndex < roleNames.length) {
    updateRoleCard();
  } else {
  buildRoleGuessList();
  showRoleDiscussionPrompt();
  startRoleTimer(); 
  buildRoleReminders();
  show("role-discussion");
}
}

 function buildRoleGuessList() {
  const wrap = document.getElementById("roleGuessList");
  wrap.innerHTML = "";
  roleGuesses = {};

  roleNames.forEach(name => {
    const card = document.createElement("div");
    card.className = "card";

    const label = document.createElement("b");
    label.textContent = name;

    const select = document.createElement("select");
    select.style.marginTop = "14px";
select.style.padding = "6px";

    roleBank.forEach(role => {
      const opt = document.createElement("option");
      opt.value = role;
      opt.textContent = role;
      select.appendChild(opt);
    });

    select.onchange = () => {
      roleGuesses[name] = select.value;
    };

    card.appendChild(label);
    card.appendChild(select);
    wrap.appendChild(card);
  });
}


  function showRoleResults() {
  const wrap = document.getElementById("roleResults");
  wrap.innerHTML = "";

  roleNames.forEach((name, i) => {
    const guessed = roleGuesses[name] || "No guess";

    wrap.innerHTML += `
      <div class="card">
        <b>${name}</b><br>
        Actual: <strong>${rolePlayers[i]}</strong><br>
        Guessed: ${guessed}
      </div>
    `;
  });

  show("role-results");
}

  function resetRoleRoulette() {
  roleNames = [];
  rolePlayers = [];
  currentRoleIndex = 0;
}

  function showRoleDiscussionPrompt() {
  const p =
    roleDiscussionPrompts[
      Math.floor(Math.random() * roleDiscussionPrompts.length)
    ];

  document.getElementById("roleDiscussionPrompt").textContent = p;
}

function rerollRolePrompt() {
  showRoleDiscussionPrompt();
}

let roleTimerInterval;
let roleTimeRemaining = 300; // 5 minutes

function startRoleTimer() {
  clearInterval(roleTimerInterval);
  roleTimeRemaining = 300;
  updateRoleTimer();

  roleTimerInterval = setInterval(() => {
    roleTimeRemaining--;
    updateRoleTimer();

    if (roleTimeRemaining <= 0) {
      clearInterval(roleTimerInterval);
    }
  }, 1000);
  setTimeout(() => {
  triggerChaos();
}, 100000); // 2.5 minutes
}

function updateRoleTimer() {
  const min = String(Math.floor(roleTimeRemaining / 60)).padStart(2, "0");
  const sec = String(roleTimeRemaining % 60).padStart(2, "0");
  document.getElementById("roleTimer").textContent = `${min}:${sec}`;
}

  function buildRoleReminders() {
  const wrap = document.getElementById("roleReminders");
  wrap.innerHTML = "<h3>Role Reminders</h3>";

  roleBank.forEach(role => {
    wrap.innerHTML += `
      <div class="role-reminder">
        <b>${role}</b>: ${roleDescriptions[role]}
      </div>
    `;
  });
}

function triggerChaos() {
  const chaos =
    roleChaosModifiers[
      Math.floor(Math.random() * roleChaosModifiers.length)
    ];

  document.getElementById("chaosTitle").textContent = chaos.title;
  document.getElementById("chaosText").textContent = chaos.text;

  document.getElementById("chaosBox").classList.remove("hidden");
}

  function clearChaos() {
  document.getElementById("chaosBox").classList.add("hidden");
}
  
</script>
    
<div id="sabPopup" class="popup hidden">
  <div class="popup-content">
    <h3>Saboteur Win Condition</h3>
    <p>
      If the Saboteur successfully misled the Guesser
      and was not caught, they win!
    </p>
    <p>
      If the spot is blank, there was no Saboteur. If the guesser beleived there was no saboteur, the teammates still win!
    </p>
    <button onclick="closeSaboteurInfo()">Got it</button>
  </div>
</div>

  <div id="rulesPopup" class="popup hidden">
  <div class="popup-content">
    <h3>How to Play</h3>
    <p>
      Everyone gets the same secret number (1‚Äì10).
      One player is the Guesser and must figure it out.
      </p>
      <p>
      One player <em>might</em> be the Saboteur, who tries to mislead the guesser.
    </p>
    <p>
      Teammates win only if the Guesser correctly guesses the number OR the Saboteur.
    </p>
     <p>
      The Saboteur wins if they stay hidden and cause a wrong guess.
    </p>
     <p>
      The Guesser must guess who they think the Saboteur is before guessing the secret number.
    </p>
    <button onclick="closeRules()">Got it!</button>
    <label class="hint-toggle">
  <input type="checkbox" id="likelihoodToggle">
  Show Saboteur Likelihood Hint
</label>
  </div>
</div>
  
  <div id="imposterRulesPopup" class="popup hidden">
  <div class="popup-content">
    <h3>How to Play: Imposter</h3>

    <p>
      One secret word is chosen.
      Most players know the word ‚Äî but one or more are <b>Imposters</b>.
    </p>

    <p>
      Players take turns asking and answering questions about the word
      without saying it directly.
    </p>

    <p>
      <b>Imposters</b> do not know the word.
      They must blend in and avoid being caught.
    </p>

    <p>
      The group discusses and tries to identify the Imposter(s).
    </p>

    <p>
      The Imposter wins if they survive undetected.
      The group wins if they identify all Imposters.
    </p>

    <button onclick="closeImposterRules()">Got it!</button>
  </div>
</div>

  <div id="roleRulesPopup" class="popup hidden">
  <div class="popup-content">
    <h3>How to Play: Role Roulette</h3>

    <p>
      Each player secretly receives a <b>behavior role</b>.
      Play a normal discussion ‚Äî but act according to your role
      without making it obvious.
    </p>

    <p><b>After all roles are revealed:</b></p>
    <ul>
      <li>Discuss who you think had each role</li>
      <li>Assign guesses during the discussion phase</li>
      <li>Reveal all roles at the end</li>
    </ul>

    <hr>

    <p><b>Roles</b></p>
    <ul>
      <li><b>Over-Explainer</b> ‚Äî Gives way too much detail</li>
      <li><b>Interruptor</b> ‚Äî Frequently cuts others off</li>
      <li><b>Question Dodger</b> ‚Äî Avoids answering directly</li>
      <li><b>Devil‚Äôs Advocate</b> ‚Äî Argues the opposite viewpoint</li>
      <li><b>Quiet Observer</b> ‚Äî Speaks as little as possible</li>
      <li><b>Chaos Agent</b> ‚Äî Causes confusion however they like</li>
    </ul>

    <button onclick="closeRoleInfo()">Got it!</button>
  </div>
</div>

</body>
</html>
